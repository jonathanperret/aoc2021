
~library/macros.tal
~library/devices.tal

( variables )

|0000

|0100 @program

  P< "parse_line: >P S< "ab,abc,abcde,|,a,ab,abc,abcd,abcde,abcdef,abcdefg,abcdefgh,ab 0a >S ;test-parse-line JSR2
  ( EXPECT parse_line:2 )
  STKCHK

  P< "parse_empty_line: >P S< 0a >S ;test-parse-line JSR2
  ( EXPECT parse_empty_line:65535 )
  STKCHK

  P< "parse_lines: >P S<
    "ab,|,ab,abc 0a
    "ab,|,abcd,abcde 0a
  >S ;test-parse-lines JSR2
  ( EXPECT parse_lines:2 )
  STKCHK

  P< "split_digits: >P S< "ab,abc,abcde,| aa >S ;test-split-digits JSR2
  ( EXPECT split_digits:ab abc abcde 0xaa )
  STKCHK

  P< "split_digits_empty_line: >P S< >S
    ;input STA2 ;get-byte-from-input ;digits ;split-digits JSR2
    [ ;digits LDA2 ] DBGSHORT POP2
  ( EXPECT split_digits_empty_line:0x0000 )
  STKCHK

  P< "üëç 0a >P
  ( EXPECT üëç )

  BRK !

~day8_lib.tal
~library/test.tal

( s* -- )
@test-parse-line
  ;input STA2
  ;get-byte-from-input ;parse-line JSR2

  DBGSHORTDEC POP2

  RTN

( s* -- )
@test-parse-lines
  ;input STA2
  ;get-byte-from-input ;parse-lines JSR2

  DBGSHORTDEC POP2

  RTN

( s* -- )
@test-split-digits
  ;input STA2
  ;get-byte-from-input ;digits ;split-digits JSR2

  ;digits ;dump-digits JSR2
  ;get-byte-from-input JSR2 DBGBYTEn POP LF

  RTN

( -- b )
@get-byte-from-input
  ;input LDA2 LDA STH
  ;input LDA2 INC2 ;input STA2
  STHr
  RTN

@input $2
@digits $100
