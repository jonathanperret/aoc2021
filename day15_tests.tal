~library/macros.tal
~library/devices.tal

( variables )

|0000

|0100 @program

  T< "matrix: >T
  S<
    "1163751742 0a
    "1381373672 0a
    "2136511328 0a
    "3694931569 0a
    "7463417111 0a
    "1319128137 0a
    "1359912421 0a
    "3125421639 0a
    "1293138521 0a
    "2311944581 0a
  >S ;make-get-byte JSR2 ;risk-matrix/parse JSR2
  ;risk-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 1 1 6 3 7 5 1 7 4 2  )
  ( EXPECT 1 3 8 1 3 7 3 6 7 2  )
  ( EXPECT 2 1 3 6 5 1 1 3 2 8  )
  ( EXPECT 3 6 9 4 9 3 1 5 6 9  )
  ( EXPECT 7 4 6 3 4 1 7 1 1 1  )
  ( EXPECT 1 3 1 9 1 2 8 1 3 7  )
  ( EXPECT 1 3 5 9 9 1 2 4 2 1  )
  ( EXPECT 3 1 2 5 4 2 1 6 3 9  )
  ( EXPECT 1 2 9 3 1 3 8 5 2 1  )
  ( EXPECT 2 3 1 1 9 4 4 5 8 1  )
  T< "cost-init: >T
  ;cost-matrix/init JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  T< "set-start: >T
  #0000 #0000 #0000 ;cost-matrix/set-at JSR2
  ;cost-matrix/dump-visited-bytes JSR2
  ( EXPECT 2 10 )
  ( EXPECT 0x80 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ;cost-matrix/dump-visited JSR2
  ( EXPECT 10 10 )
  ( EXPECT 1 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  T< "combine-at: >T
  #0000 #0000 #0001 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump-visited-bytes JSR2
  ( EXPECT 2 10 )
  ( EXPECT 0x80 0x00  )
  ( EXPECT 0x80 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ;cost-matrix/dump-visited JSR2
  ( EXPECT 10 10 )
  ( EXPECT 1 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 1 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000                                               )
  ( EXPECT 0001                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  #0000 #0001 #0000 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001                                          )
  ( EXPECT 0001                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  #0000 #0000 #ffff ;cost-matrix/combine-at JSR2
  #0000 #ffff #0000 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001                                          )
  ( EXPECT 0001                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  ( EXPECT 1 0 0001 )
  ;cost-matrix/count JSR2 DBGSHORTDEC POP2
  ( EXPECT 3 )
  T< "combine-at2: >T
  #0001 #0002 #0000 ;cost-matrix/combine-at JSR2
  #0001 #0000 #0000 ;cost-matrix/combine-at JSR2
  #0001 #0001 #ffff ;cost-matrix/combine-at JSR2
  #0001 #0001 #0001 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001 0007                                     )
  ( EXPECT 0001 0004                                          )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  T< "combine-at3: >T
  #0001 #0001 #0001 ;cost-matrix/combine-at JSR2
  #0001 #ffff #0001 ;cost-matrix/combine-at JSR2
  #0001 #0000 #0000 ;cost-matrix/combine-at JSR2
  #0001 #0000 #0002 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001 0007                                     )
  ( EXPECT 0001 0004                                          )
  ( EXPECT 0003                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  ( EXPECT 1 0 0001 )
  ( EXPECT 2 0 0007 )
  ( EXPECT 1 1 0004 )
  ( EXPECT 0 2 0003 )
  T< "flood-from: >T
  #0000 #0002 ;cost-matrix/flood-from JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001 0007                                     )
  ( EXPECT 0001 0004                                          )
  ( EXPECT 0003 0004                                          )
  ( EXPECT 0006                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  ( EXPECT 1 0 0001 )
  ( EXPECT 2 0 0007 )
  ( EXPECT 1 1 0004 )
  ( EXPECT 0 2 0003 )
  ( EXPECT 1 2 0004 )
  ( EXPECT 0 3 0006 )
  T< "flood-matching: >T
  #0003 ;cost-matrix/flood-matching JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001 0007                                     )
  ( EXPECT 0001 0004                                          )
  ( EXPECT 0003 0004                                          )
  ( EXPECT 0006                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  T< "flood-matching2: >T
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  ( EXPECT 1 0 0001 )
  ( EXPECT 2 0 0007 )
  ( EXPECT 1 1 0004 )
  ( EXPECT 0 2 0003 )
  ( EXPECT 1 2 0004 )
  ( EXPECT 0 3 0006 )
  #0004 ;cost-matrix/flood-matching JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001 0007                                     )
  ( EXPECT 0001 0004 000c                                     )
  ( EXPECT 0003 0004 0007                                     )
  ( EXPECT 0006 000a                                          )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  T< "flood-matching3: >T
  #0006 ;cost-matrix/flood-matching JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001 0007                                     )
  ( EXPECT 0001 0004 000c                                     )
  ( EXPECT 0003 0004 0007                                     )
  ( EXPECT 0006 000a                                          )
  ( EXPECT 000d                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  T< "flood-matching4: >T
  #0007 ;cost-matrix/flood-matching JSR2
  ;cost-matrix/dump-visited JSR2
  ( EXPECT 10 10 )
  ( EXPECT 1 1 1 1 0 0 0 0 0 0  )
  ( EXPECT 1 1 1 0 0 0 0 0 0 0  )
  ( EXPECT 1 1 1 1 0 0 0 0 0 0  )
  ( EXPECT 1 1 1 0 0 0 0 0 0 0  )
  ( EXPECT 1 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001 0007 000a                                )
  ( EXPECT 0001 0004 000c                                     )
  ( EXPECT 0003 0004 0007 000d                                )
  ( EXPECT 0006 000a 0010                                     )
  ( EXPECT 000d                                               )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  ( EXPECT                                                    )
  T< "flood-all: >T
  ;cost-matrix/flood-all JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0001 0007 000a 0011 0016 0017 001e 0022 0024  )
  ( EXPECT 0001 0004 000c 000b 000e 0015 0017 001d 0020 0022  )
  ( EXPECT 0003 0004 0007 000d 0012 0013 0014 0017 0019 0021  )
  ( EXPECT 0006 000a 0010 0011 001a 0016 0015 001a 001f 0026  )
  ( EXPECT 000d 000e 0014 0014 0018 0017 001c 001b 001c 001d  )
  ( EXPECT 000e 0011 0012 001b 0019 0019 0021 001c 001f 0024  )
  ( EXPECT 000f 0012 0017 0020 0022 001a 001c 0020 0021 0022  )
  ( EXPECT 0012 0013 0015 001a 001e 001c 001d 0023 0024 002b  )
  ( EXPECT 0013 0015 001e 001d 001e 001f 0025 0028 0026 0027  )
  ( EXPECT 0015 0018 0019 001a 0023 0023 0027 002c 002e 0028  )
  T< "get-end-cost: >T
  ;cost-matrix/get-end-cost JSR2 DBGSHORTDEC POP2
  ( EXPECT 40 )


  T< "👍 >T
  BRK !

( s* -- get-byte )
@make-get-byte
  ;input STA2
  ;get-byte-from-input
  RTN

( -- b )
@get-byte-from-input
  [ ;input LDA2 ] LDA STH
  [ ;input LDA2 ] INC2 [ ;input STA2 ]
  STHr
  RTN

@input $2

~library/test.tal
~day15_lib.tal
