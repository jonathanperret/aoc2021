~library/macros.tal
~library/devices.tal

( variables )

|0000

|0100 @program

  T< "matrix: >T
  S<
    "1163751742 0a
    "1381373672 0a
    "2136511328 0a
    "3694931569 0a
    "7463417111 0a
    "1319128137 0a
    "1359912421 0a
    "3125421639 0a
    "1293138521 0a
    "2311944581 0a
  >S ;make-get-byte JSR2 ;risk-matrix/parse JSR2
  ;risk-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 1 1 6 3 7 5 1 7 4 2  )
  ( EXPECT 1 3 8 1 3 7 3 6 7 2  )
  ( EXPECT 2 1 3 6 5 1 1 3 2 8  )
  ( EXPECT 3 6 9 4 9 3 1 5 6 9  )
  ( EXPECT 7 4 6 3 4 1 7 1 1 1  )
  ( EXPECT 1 3 1 9 1 2 8 1 3 7  )
  ( EXPECT 1 3 5 9 9 1 2 4 2 1  )
  ( EXPECT 3 1 2 5 4 2 1 6 3 9  )
  ( EXPECT 1 2 9 3 1 3 8 5 2 1  )
  ( EXPECT 2 3 1 1 9 4 4 5 8 1  )
  T< "cost-init: >T
  ;cost-matrix/init JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  T< "set-start: >T
  #0000 #0000 #0000 ;cost-matrix/set-at JSR2
  ;cost-matrix/dump-visited-bytes JSR2
  ( EXPECT 2 10 )
  ( EXPECT 0x80 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ;cost-matrix/dump-visited JSR2
  ( EXPECT 10 10 )
  ( EXPECT 1 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  T< "combine-at: >T
  #0000 #0000 #0001 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump-visited-bytes JSR2
  ( EXPECT 2 10 )
  ( EXPECT 0x80 0x00  )
  ( EXPECT 0x80 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ( EXPECT 0x00 0x00  )
  ;cost-matrix/dump-visited JSR2
  ( EXPECT 10 10 )
  ( EXPECT 1 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 1 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  #0000 #0001 #0000 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  #0000 #0000 #ffff ;cost-matrix/combine-at JSR2
  #0000 #ffff #0000 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  ( EXPECT 1 0 0001 )
  ;cost-matrix/count JSR2 DBGSHORTDEC POP2
  ( EXPECT 3 )
  T< "combine-at2: >T
  #0001 #0002 #0000 ;cost-matrix/combine-at JSR2
  #0001 #0000 #0000 ;cost-matrix/combine-at JSR2
  #0001 #0001 #ffff ;cost-matrix/combine-at JSR2
  #0001 #0001 #0001 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 8007 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 8004 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  T< "combine-at3: >T
  #0001 #0001 #0001 ;cost-matrix/combine-at JSR2
  #0001 #ffff #0001 ;cost-matrix/combine-at JSR2
  #0001 #0000 #0000 ;cost-matrix/combine-at JSR2
  #0001 #0000 #0002 ;cost-matrix/combine-at JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 8007 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 8004 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8003 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  ( EXPECT 1 0 0001 )
  ( EXPECT 2 0 0007 )
  ( EXPECT 1 1 0004 )
  ( EXPECT 0 2 0003 )
  T< "flood-from: >T
  #0000 #0002 ;cost-matrix/flood-from JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 8007 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 8004 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8003 8004 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8006 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  ( EXPECT 1 0 0001 )
  ( EXPECT 2 0 0007 )
  ( EXPECT 1 1 0004 )
  ( EXPECT 0 2 0003 )
  ( EXPECT 1 2 0004 )
  ( EXPECT 0 3 0006 )
  T< "flood-matching: >T
  #0003 ;cost-matrix/flood-matching JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 8007 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 8004 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8003 8004 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8006 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  T< "flood-matching2: >T
  ;cost-matrix/list-dump JSR2
  ( EXPECT 0 0 0000 )
  ( EXPECT 0 1 0001 )
  ( EXPECT 1 0 0001 )
  ( EXPECT 2 0 0007 )
  ( EXPECT 1 1 0004 )
  ( EXPECT 0 2 0003 )
  ( EXPECT 1 2 0004 )
  ( EXPECT 0 3 0006 )
  #0004 ;cost-matrix/flood-matching JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 8007 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 8004 800c 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8003 8004 8007 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8006 800a 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  T< "flood-matching3: >T
  #0006 ;cost-matrix/flood-matching JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 8007 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 8004 800c 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8003 8004 8007 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8006 800a 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 800d 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  T< "flood-matching4: >T
  #0007 ;cost-matrix/flood-matching JSR2
  ;cost-matrix/dump-visited JSR2
  ( EXPECT 10 10 )
  ( EXPECT 1 1 1 1 0 0 0 0 0 0  )
  ( EXPECT 1 1 1 0 0 0 0 0 0 0  )
  ( EXPECT 1 1 1 1 0 0 0 0 0 0  )
  ( EXPECT 1 1 1 0 0 0 0 0 0 0  )
  ( EXPECT 1 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ( EXPECT 0 0 0 0 0 0 0 0 0 0  )
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 8007 800a 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8001 8004 800c 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8003 8004 8007 800d 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 8006 800a 8010 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 800d 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  ( EXPECT 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000  )
  T< "flood-all: >T
  ;cost-matrix/flood-all JSR2
  ;cost-matrix/dump JSR2
  ( EXPECT 10 10 )
  ( EXPECT 8000 8001 8007 800a 8011 8016 8017 801e 8022 8024  )
  ( EXPECT 8001 8004 800c 800b 800e 8015 8017 801d 8020 8022  )
  ( EXPECT 8003 8004 8007 800d 8012 8013 8014 8017 8019 8021  )
  ( EXPECT 8006 800a 8010 8011 801a 8016 8015 801a 801f 8026  )
  ( EXPECT 800d 800e 8014 8014 8018 8017 801c 801b 801c 801d  )
  ( EXPECT 800e 8011 8012 801b 8019 8019 8021 801c 801f 8024  )
  ( EXPECT 800f 8012 8017 8020 8022 801a 801c 8020 8021 8022  )
  ( EXPECT 8012 8013 8015 801a 801e 801c 801d 8023 8024 802b  )
  ( EXPECT 8013 8015 801e 801d 801e 801f 8025 8028 8026 8027  )
  ( EXPECT 8015 8018 8019 801a 8023 8023 8027 802c 802e 8028  )
  T< "get-end-cost: >T
  ;cost-matrix/get-end-cost JSR2 DBGSHORTDEC POP2
  ( EXPECT 40 )


  T< "👍 >T
  BRK !

( s* -- get-byte )
@make-get-byte
  ;input STA2
  ;get-byte-from-input
  RTN

( -- b )
@get-byte-from-input
  [ ;input LDA2 ] LDA STH
  [ ;input LDA2 ] INC2 [ ;input STA2 ]
  STHr
  RTN

@input $2

~library/test.tal
~day15_lib.tal
